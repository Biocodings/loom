{
  "requester": "someone@example.net", 
  "workflows": [
    {
      "data_pipes": [
        {
          "source": {
            "step": "split_step", 
            "port": "bam_array"
          }, 
          "destination": {
            "step": "process_step", 
            "port": "bam"
          }
        }, 
        {
          "source": {
            "step": "process_step", 
            "port": "bam"
          }, 
          "destination": {
            "step": "merge_step", 
            "port": "bam_array"
          }
        }
      ], 
      "data_bindings": [
        {
          "destination": {
            "step": "split_step", 
            "port": "bam"
          }, 
          "data": {
            "hash_value": "???", 
            "type": "file", 
            "hash_function": "md5"
          }
        }
      ], 
      "steps": [
        {
          "name": "split_step", 
          "input_ports": [
            {
              "file_name": "input.bam", 
              "type": "file", 
              "name": "bam"
            }
          ], 
          "environment": {
            "docker_image": "ubuntu"
          }, 
          "command": "for chr in chr1 chr2 chr3 do samtools view {{ input_ports.bam }} $chr > $chr.bam; done", 
          "output_ports": [
            {
              "glob": "chr*.bam", 
              "type": "file_array", 
              "name": "bam_array"
            }
          ], 
          "resources": {
            "cores": "1", 
            "memory": "1GB"
          }
        }, 
        {
          "name": "process_step", 
          "input_ports": [
            {
              "type": "file", 
              "name": "bam"
            }
          ], 
          "environment": {
            "docker_image": "ubuntu"
          }, 
          "command": "process_chromosome {{ input_ports.bam }} > {{ output_ports.bam }}", 
          "output_ports": [
            {
              "type": "file", 
              "name": "bam", 
              "filename": "{{ input_ports.bam }}.processed"
            }
          ], 
          "resources": {
            "cores": "1", 
            "memory": "1GB"
          }
        }, 
        {
          "name": "merge_step", 
          "input_ports": [
            {
              "type": "file_array", 
              "name": "bam_array"
            }
          ], 
          "environment": {
            "docker_image": "ubuntu"
          }, 
          "command": "samtools merge {{ output_ports.merged_bam }}{% for bamfile in input_ports.bam_array %} {{ bamfile }}{% endfor %}", 
          "output_ports": [
            {
              "file_name": "out.bam", 
              "type": "file", 
              "name": "merged_bam"
            }
          ], 
          "resources": {
            "cores": "1", 
            "memory": "1GB"
          }
        }
      ], 
      "name": "split_merge"
    }
  ]
}
